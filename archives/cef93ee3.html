<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>单元测试 | Daggry House</title><meta name="author" content="Daggry"><meta name="copyright" content="Daggry"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="单元测试过程中的一些总结，记录如何利用 Mockito 和 JUnit 来编写单元测试。 认识一下🚀 什么是单元测试？单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证，这些测试有助于验证代码是否正常运行并识别任何错误或错误。至于“单元”的大小或范围，并没有一个明确的标准，“单元”可以是一个函数、方法、类、功能模块或者子系统。这种类型的测试完全孤立地集中在整个应用程">
<meta property="og:type" content="article">
<meta property="og:title" content="单元测试">
<meta property="og:url" content="http://sazxsdawn2022.github.io/archives/cef93ee3.html">
<meta property="og:site_name" content="Daggry House">
<meta property="og:description" content="单元测试过程中的一些总结，记录如何利用 Mockito 和 JUnit 来编写单元测试。 认识一下🚀 什么是单元测试？单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证，这些测试有助于验证代码是否正常运行并识别任何错误或错误。至于“单元”的大小或范围，并没有一个明确的标准，“单元”可以是一个函数、方法、类、功能模块或者子系统。这种类型的测试完全孤立地集中在整个应用程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg">
<meta property="article:published_time" content="2023-11-04T12:00:00.000Z">
<meta property="article:modified_time" content="2023-11-04T12:00:00.000Z">
<meta property="article:author" content="Daggry">
<meta property="article:tag" content="单测">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg"><link rel="shortcut icon" href="/img/tb.png"><link rel="canonical" href="http://sazxsdawn2022.github.io/archives/cef93ee3.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="baidu-site-verification" content="codeva-dkeX8im1Rp"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Daggry","link":"链接: ","source":"来源: Daggry House","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '单元测试',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-04 20:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/tx.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Daggry House"><span class="site-name">Daggry House</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">单元测试</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-04T12:00:00.000Z" title="发表于 2023-11-04 20:00:00">2023-11-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-04T12:00:00.000Z" title="更新于 2023-11-04 20:00:00">2023-11-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8D%95%E6%B5%8B/">单测</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>单元测试过程中的一些总结，记录如何利用 Mockito 和 JUnit 来编写单元测试。</p>
<h1 id="认识一下"><a href="#认识一下" class="headerlink" title="认识一下"></a>认识一下</h1><h2 id="🚀-什么是单元测试？"><a href="#🚀-什么是单元测试？" class="headerlink" title="🚀 什么是单元测试？"></a>🚀 什么是单元测试？</h2><p>单元测试（unit testing），是指对软件中的<strong>最小可测试单元</strong>进行检查和验证，这些测试有助于验证代码是否正常运行并识别任何错误或错误。至于“单元”的大小或范围，并没有一个明确的标准，“单元”可以是一个函数、方法、类、功能模块或者子系统。<br>这种类型的测试完全<strong>孤立</strong>地集中在整个应用程序的一部分上。通常，它是单个类或函数。理想情况下，该装置没有任何副作用。以便尽可能容易地对其进行隔离和测试。<br>单元测试是自动化测试。换句话说，单元测试是由软件（例如单元测试框架或单元测试工具）执行的，而不是由开发人员手动执行的。这意味着单元测试允许自动化、可重复、连续的测试。<br><strong>作为开发人员</strong>，一旦编写完一段代码，就会编写单元测试。我们可能会问，这不是测试员的工作吗？在某种程度上，是的，测试人员负责测试软件。但是，覆盖每一行代码给测试人员增加了很大的压力。因此，开发人员为自己的代码编写测试也是最佳实践。</p>
<p><strong>😘优点：</strong></p>
<ol>
<li>质量问题识别：单元测试有助于识别与安全性、保密性和可靠性相关的缺陷，确保更高的代码质量。</li>
<li>功能需求的验证：单元测试确保满足各个代码单元的功能需求，从而促进准确的功能。</li>
<li>结构代码覆盖率：单元测试有助于实现全面的代码覆盖率，确保测试不同的代码路径。</li>
<li>合规性要求：单元测试有助于满足合规性要求，确保代码符合监管标准。</li>
<li>回归测试：可以重复使用单元测试来检测代码回归，从而确保更改或更新不会破坏现有功能。</li>
<li>简化调试：通过单独测试各个单元，单元测试简化了调试过程，从而更容易定位和修复问题。</li>
<li>应用程序指标：单元测试提供了有关应用程序运行状况的有价值的指标，并突出显示了值得关注的领域或潜在的瓶颈。<div style="background-color: #FFFFE0; border-radius: 10px; padding: 10px;">
提示：概念这个东西大概理解是什么意思即可~
</div></li>
</ol>
<h2 id="🚀-为什么要进行单元测试？"><a href="#🚀-为什么要进行单元测试？" class="headerlink" title="🚀 为什么要进行单元测试？"></a>🚀 为什么要进行单元测试？</h2><p>单元测试的目标是确保任何新功能不会破坏现有功能。它还有助于在开发过程的早期发现任何问题或错误，并有助于确保代码符合组织制定的质量标准。<br>单元测试很重要，因为软件开发人员有时会尝试通过最少的单元测试来节省时间，但这是神话，因为不适当的单元测试会导致在系统测试、集成测试甚至应用程序构建后的 Beta 测试期间修复缺陷的成本很高。如果在早期开发中进行适当的单元测试，那么最终可以节省时间和金钱。<br>通过进行单元测试，开发人员可以在集成不同组件并进行回归测试之前更好地控制各个代码块的质量。它还有助于及早识别和解决代码级别的错误或缺陷。与在开发周期后期发现缺陷相比，这种主动方法显著降低了成本。</p>
<h2 id="🚀-工作流程"><a href="#🚀-工作流程" class="headerlink" title="🚀 工作流程"></a>🚀 工作流程</h2><p>该测试一般分为四个步骤：</p>
<ol>
<li>第一步是创建测试用例或弄清楚想要测试什么以及如何测试。</li>
<li>第二步是编写测试代码。</li>
<li>第三步是运行测试，如果测试通过，代码就会执行它应该执行的操作，可以继续。如果测试失败，则代码中存在错误，需要在继续之前对其进行调试。</li>
<li>第四步是维护测试。当代码发生变化时，需要相应地更新测试。这可能意味着添加新的测试用例或修改现有的测试用例。</li>
</ol>
<h1 id="如何编写"><a href="#如何编写" class="headerlink" title="如何编写"></a>如何编写</h1><h2 id="🐬-编写步骤"><a href="#🐬-编写步骤" class="headerlink" title="🐬 编写步骤"></a>🐬 编写步骤</h2><p>OK，万丈高楼平地起，我们来看一下单元测试该怎么来一步步编写。<br>对于一个新手来说，以下是编写单元测试的一般步骤：</p>
<ol>
<li><strong>确定被测试的代码</strong>：首先，确定要测试的代码。这可以是一个方法、一个类或者一个模块。确保对被测试代码的功能和预期行为有清晰的理解。</li>
<li><strong>引入测试框架和依赖</strong>：选择适合的项目测试框架，如 JUnit、TestNG 等，并将其添加到项目的依赖中。可能还需要引入其他的测试工具或模拟库，如 Mockito、PowerMockito 等。</li>
<li><strong>创建测试类</strong>：创建一个新的测试类，命名规范一般为被测试类名 + “Test” 后缀，例如，如果被测试类是 Calculator，则测试类可以命名为 CalculatorTest。在测试类中，导入相关的测试框架和依赖。</li>
<li><strong>编写测试方法</strong>：在测试类中，编写测试方法来测试被测试代码的各种情况。每个测试方法应该是独立的，测试不同的方面或场景。使用 @Test 注解来标记测试方法。</li>
<li><strong>准备测试数据</strong>：为了执行测试，可能需要准备一些测试数据。这可以是输入参数、模拟对象或者设置测试环境。确保测试数据能够覆盖不同的情况和边界条件。</li>
<li><strong>执行测试</strong>：使用测试框架提供的运行器或者 IDE 的测试运行功能来执行测试。确保所有的测试方法都能够运行，并检查测试结果。</li>
<li><strong>断言结果</strong>：在每个测试方法中，使用断言语句来验证被测试代码的行为和结果。根据预期结果，选择合适的断言方法来判断实际结果是否符合预期。</li>
<li><strong>处理异常情况</strong>：确保我们的测试代码覆盖到被测试代码可能引发的异常情况，并验证被测试代码在异常情况下的行为和处理逻辑。</li>
<li><strong>重复和扩展</strong>：根据需要，编写更多的测试方法来覆盖更多的场景和边界情况。重复执行测试，确保代码的稳定性和可靠性。</li>
<li><strong>持续集成和自动化</strong>：将单元测试集成到持续集成流程中，并使用自动化测试工具和脚本来自动运行测试。这样可以确保每次代码变更都能够及时进行测试，并提供及时反馈。<br>这些是编写单元测试的一般步骤，但实际编写过程可能因项目需求和具体情况而有所不同。<strong>关键是理解被测试代码的功能和预期行为</strong>，并编写针对不同情况的测试方法来验证其正确性。<br>好了，现在知道该怎么编写了吧？快去写吧！哈哈，开玩笑的，下面的部分会介绍怎么使用测试框架 Mockito 来进行单元测试的编写。</li>
</ol>
<h2 id="🐬-编写原则"><a href="#🐬-编写原则" class="headerlink" title="🐬 编写原则"></a>🐬 编写原则</h2><p>单元测试用例的原则是什么:</p>
<ul>
<li>测试类应该只测试一个功能，否则会违反了单一职责原则。</li>
<li>测试代码时，只考虑测试，不考虑内部实现。</li>
<li>数据尽量模拟现实，越靠近现实越好。</li>
<li>充分考虑数据的边界条件下。</li>
<li>对重点、复杂、核心代码、重点测试。</li>
<li>测试、功能开发相结合，有利于设计和代码重构。</li>
</ul>
<h2 id="🐬-覆盖率"><a href="#🐬-覆盖率" class="headerlink" title="🐬 覆盖率"></a>🐬 覆盖率</h2><p>单元测试覆盖率是一种衡量软件测试质量的指标，用于评估在单元测试中对源代码的覆盖情况。它衡量了测试用例能够覆盖代码中多少部分的执行路径和逻辑。单元测试覆盖率可以帮助开发人员确定测试案例是否足够全面，是否覆盖了代码的各个执行分支和边界条件。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>单元测试覆盖率的原理是通过分析源代码的执行路径，确定哪些部分被测试用例覆盖，哪些部分未被覆盖。覆盖率工具会在代码执行期间跟踪记录代码的执行情况，生成相应的统计信息。这些统计信息可以用来计算代码行、分支、条件等的覆盖情况。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>单元测试覆盖率通常分为以下几种类型：</p>
<ol>
<li>语句覆盖（Statement Coverage）： 衡量测试用例是否覆盖了源代码中的每一条语句。它关注的是代码中的每个语句是否被执行到。</li>
<li>分支覆盖（Branch Coverage）： 衡量测试用例是否覆盖了源代码中所有的分支。它关注的是条件语句（如 if、switch）中每个可能的分支是否都被覆盖到。</li>
<li>条件覆盖（Condition Coverage）： 衡量测试用例是否覆盖了源代码中的每个条件。它关注的是每个条件表达式的每个可能取值是否都被覆盖到。</li>
<li>路径覆盖（Path Coverage）： 衡量测试用例是否覆盖了源代码中的每条可能路径。它关注的是代码中所有可能的执行路径是否都被覆盖到。</li>
</ol>
<h3 id="计算方法"><a href="#计算方法" class="headerlink" title="计算方法"></a>计算方法</h3><p>单元测试覆盖率通常以百分比的形式表示，表示覆盖的代码部分在总代码中的比例。计算方法可以根据不同的覆盖率类型进行调整。<br>一般而言，覆盖率计算公式如下：<br>覆盖率 &#x3D; (被覆盖的代码部分数量 &#x2F; 总代码部分数量) * 100%<br>例如，假设有一段代码有 100 条语句，其中 80 条语句被测试用例覆盖到，那么语句覆盖率为 80%。</p>
<p>对于分支覆盖、条件覆盖和路径覆盖，计算方法略有不同，需要考虑代码中的分支、条件或路径数量。</p>
<p>在实际应用中，可以使用各种测试覆盖率工具来自动计算代码的覆盖率。常见的 Java 测试覆盖率工具包括 JaCoCo、Cobertura、Emma 等。这些工具可以生成详细的覆盖率报告，帮助开发人员分析测试用例的覆盖情况并进行优化。</p>
<h3 id="分支覆盖和条件覆盖的区别"><a href="#分支覆盖和条件覆盖的区别" class="headerlink" title="分支覆盖和条件覆盖的区别"></a>分支覆盖和条件覆盖的区别</h3><p>分支覆盖和条件覆盖是单元测试覆盖率中的两个相关概念，它们有以下区别：</p>
<p><strong>分支覆盖（Branch Coverage）：</strong><br>分支覆盖衡量测试用例是否覆盖了源代码中的所有分支。分支是指条件语句（如 if、switch）中的每个可能的路径。分支覆盖要求每个条件语句的每个分支都至少被测试用例执行一次。它关注的是代码中分支的执行情况，以确保测试用例能够覆盖不同的条件路径。<br>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 分支1</span></span><br><span class="line">System.out.println(<span class="string">&quot;x is positive&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 分支2</span></span><br><span class="line">System.out.println(<span class="string">&quot;x is non-positive&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，分支覆盖要求至少有一个测试用例覆盖 x &gt; 0 条件为真的情况（分支1）和至少有一个测试用例覆盖 x &gt; 0 条件为假的情况（分支2）。</p>
<p><strong>条件覆盖（Condition Coverage）</strong>：<br>条件覆盖衡量测试用例是否覆盖了源代码中的每个条件。条件是指条件语句中的每个条件表达式。每个条件表达式通常包含一个或多个子条件，例如逻辑运算符（如 &amp;&amp;、||）组合的多个条件。条件覆盖要求每个条件表达式的每个可能取值至少被测试用例覆盖一次。它关注的是代码中条件的执行情况，以确保测试用例能够覆盖不同的条件组合。<br>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; y &lt; <span class="number">10</span>) &#123;</span><br><span class="line"><span class="comment">// 条件1为真，条件2为真</span></span><br><span class="line">System.out.println(<span class="string">&quot;Both conditions are true&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 条件1或条件2至少有一个为假</span></span><br><span class="line">System.out.println(<span class="string">&quot;At least one condition is false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，条件覆盖要求至少有一个测试用例覆盖 x &gt; 0 条件为真且 y &lt; 10 条件为真的情况，以及至少有一个测试用例覆盖其他三种情况（其中一个条件为假）。</p>
<p><strong>总结：</strong></p>
<ul>
<li>分支覆盖关注的是代码中分支的执行情况，要求每个分支至少被一个测试用例执行一次。</li>
<li>条件覆盖关注的是代码中条件的执行情况，要求每个条件表达式的每个可能取值至少被一个测试用例执行一次。<br>通常情况下，条件覆盖是分支覆盖的一种更严格的要求。也就是说，如果测试用例满足了条件覆盖，那么它一定也满足了分支覆盖。但是，分支覆盖可能包含一些额外的情况，因为一个分支中可能包含多个条件表达式。因此，在设计测试用例时，可以根据具体情况选择使用分支覆盖或条件覆盖，以满足测试的要求。</li>
</ul>
<h1 id="mock-和-mockito"><a href="#mock-和-mockito" class="headerlink" title="mock 和 mockito"></a>mock 和 mockito</h1><h2 id="🛵-基础知识"><a href="#🛵-基础知识" class="headerlink" title="🛵 基础知识"></a>🛵 基础知识</h2><p>在软件开发中提及”mock”，通常理解为模拟对象。</p>
<h2 id="🤔为什么需要模拟（mock）"><a href="#🤔为什么需要模拟（mock）" class="headerlink" title="🤔为什么需要模拟（mock）?"></a>🤔为什么需要模拟（mock）?</h2><p>在我们一开始学编程时,我们所写的对象通常都是独立的，并不依赖其他的类，也不会操作别的类。但实际上，软件中是充满依赖关系的，比如我们会基于service类写操作类,而service类又是基于数据访问类(DAO)的，依次下去，形成复杂的依赖关系。<br>单元测试的思路就是我们想<strong>在不涉及依赖关系的情况下测试代码</strong>。这种测试可以让你无视代码的依赖关系去测试代码的有效性。核心思想就是如果代码按设计正常工作，并且依赖关系也正常，那么他们应该会同时工作正常。<br>有些时候，我们代码所需要的依赖可能尚未开发完成，甚至还不存在，那如何让我们的开发进行下去呢？使用mock可以让开发进行下去，<strong>mock技术的目的和作用就是模拟一些在应用中不容易构造或者比较复杂的对象，从而把测试与测试边界以外的对象隔离开。</strong><br>我们可以自己编写自定义的Mock对象实现mock技术，但是编写自定义的Mock对象需要额外的编码工作，同时也可能引入错误。现在实现mock技术的优秀开源框架有很多，Mockito就是一个优秀的用于单元测试的mock框架。<br>比如，在使用spring开发时有时候我们并不想把整个spring容器跑起来。有了mockito我们就可以方便的对一些依赖项进行mock，这样我们只需要验证需要测试的一小部分代码逻辑，测试类也会跑的很快。</p>
<p><strong>小贴士</strong><br>JUnit 是单元测试框架。Mockito 与 JUnit 不同，并不是单元测试框架（这方面 JUnit 已经足够好了），它是用于生成模拟对象或者直接点说，就是”假对象“的工具。两者定位不同，所以一般通常的做法就是联合 JUnit + Mockito 来进行测试。</p>
<p><strong>小记</strong><br>一、为什么需要 mock ？<br>Mock 可以理解为一个虚假的对象，模拟出一个对象，在测试环境中用来替换掉真实的对象，以达到我们可以：<br>1、验证该对象某些方法的调用情况，调用了多少次，参数是什么。<br>2、给这个对象的行为做一个定义，来指定返回结果或者是指定特定的动作。</p>
<p>二、Mock方法<br>Mockito.mock(类)：Mock 方法模拟出一个对象或者接口</p>
<p>三、验证和断言<br>Mockito.verify()方法：校验待验证的的对象是否发生过某些行为。verify 配合 time() 方法可以校验某些操作发生的次数：Mockito.verify(对象, Mockito.times(1)).nextInt()</p>
<p>四、给 Mock 对象打桩<br>意思就是给 mock 对象的行为做定义，让 mock 对象执行操作后返回提前规定好的值。Mockito.when(对象. 方法). 要求的相应。</p>
<p>五、@Mock 注解<br>可以理解为快速创建 mock 对象的一种方法，之前是用 Mockito.mock(对象)方法，现在定义一个类直接在类上添加 @Mock 注解来代替。<br>要注意的是 mock 注解要配合 MockitoAnnototions.openMocks(类) 方法一起使用，来使 mock 注解生效。</p>
<p>六、@BeforeEach 和 @AfterEach 注解<br>beforeEach 注解的方法是执行测试前的准备。<br>beforeAfter 注解的方法是执行测试后执行的。</p>
<p>七、Spy 方法和 @Spy 注解<br>Spy 方法和 mock 方法不同的是 spy 的对象会走真实的方法，而 mock 的对象不会；<br>Spy 方法的参数是对象实例，mock 方法的参数是类。</p>
<h2 id="🛵-基础使用"><a href="#🛵-基础使用" class="headerlink" title="🛵 基础使用"></a>🛵 基础使用</h2><p>下面将介绍 Mockto 的基本使用，包括如何利用 Mockito 创建模拟对象，如何打桩，调用完方法后怎么做验证。在对应的代码片段中将展示如何使用。</p>
<h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>在 Maven 项目中使用 Mockito，将以下依赖项添加到 pom 文件中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mockito<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mockito-inline<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>&#123;mockitoversion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mockito<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mockito-junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>&#123;mockitoversion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>mockito-inline 是 mockito-core 的 Java 16 就绪版本。它还支持静态方法和最终类的模拟，在第四部分会说明。</p>
<h3 id="使用-Mockito-API-创建模拟对象"><a href="#使用-Mockito-API-创建模拟对象" class="headerlink" title="使用 Mockito API 创建模拟对象"></a>使用 Mockito API 创建模拟对象</h3><p>Mockito 提供了几种创建模拟对象的方法：</p>
<ul>
<li>将JUnit 5 的扩展与字段注释<code>@ExtendWith(MockitoExtension.class)</code>结合使用@Mock</li>
<li>使用静态<code>mock()</code>方法。</li>
<li>使用<code>@Mock</code>注释。<br>如果使用@Mock注解，则必须触发注解字段的初始化。MockitoExtension通过调用静态方法来完成此操作MockitoAnnotations.initMocks(this)。</li>
</ul>
<p>现在假如我们有一个 Database 类，Service 类，在 Service 类中使用了 Database 类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Database</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAvailable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUniqueId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Database database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Service</span><span class="params">(Database database)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.database = database;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">query</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> database.isAvailable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Using database with id: &quot;</span> + String.valueOf(database.getUniqueId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们来使用 Mockito 模拟对象的单元测试Database</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span>                         </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    Database databaseMock;                                  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span>  &#123;</span><br><span class="line">        assertNotNull(databaseMock);</span><br><span class="line">        when(databaseMock.isAvailable()).thenReturn(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Service</span> <span class="variable">t</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Service</span>(databaseMock);             </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> t.query(<span class="string">&quot;* from t&quot;</span>);                </span><br><span class="line">        assertTrue(check);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置mock对象方法调用的返回值"><a href="#配置mock对象方法调用的返回值" class="headerlink" title="配置mock对象方法调用的返回值"></a>配置mock对象方法调用的返回值</h3><p>Mockito 允许配置通过 Fluent API 在模拟上调用的方法的返回值。</p>
<ul>
<li>🍓 <code>when(….).thenReturn(….)</code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceDatabaseIdTest</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  Database databaseMock;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">ensureMockitoReturnsTheConfiguredValue</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">          <span class="comment">// 为方法getUniqueId（）定义返回值</span></span><br><span class="line">          when(databaseMock.getUniqueId()).thenReturn(<span class="number">42</span>);</span><br><span class="line">  </span><br><span class="line">          <span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Service</span>(databaseMock);</span><br><span class="line">          <span class="comment">// 在测试中使用mock</span></span><br><span class="line">          assertEquals(service.toString(), <span class="string">&quot;Using database with id: 42&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>🍓 <code>doReturn when和doThrow when</code><br>方法doReturn(…).when(…)配置可用于配置模拟方法调用的回复。这类似于when(….).thenReturn(….).<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoSpyWithListTest</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">ensureSpyForListWorks</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">  <span class="type">var</span> <span class="variable">spiedList</span> <span class="operator">=</span> spy(list);</span><br><span class="line"></span><br><span class="line">        doReturn(<span class="string">&quot;42&quot;</span>).when(spiedList).get(<span class="number">99</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) spiedList.get(<span class="number">99</span>);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">&quot;42&quot;</span>, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="用-Spy-包装-Java-对象"><a href="#用-Spy-包装-Java-对象" class="headerlink" title="用 Spy 包装 Java 对象"></a>用 Spy 包装 Java 对象</h3><p>@Spy 或该spy() 方法可用于包装真实对象。除非另有指定，否则每次调用都会委托给该对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoSpyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Spy</span></span><br><span class="line">    List&lt;String&gt; spy = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 也可以在里创建 spy 对象</span></span><br><span class="line">        <span class="comment">// List&lt;String&gt; list = new LinkedList&lt;&gt;();</span></span><br><span class="line">        <span class="comment">// List&lt;String&gt; spy = spy(list);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testLinkedListSpyCorrect</span><span class="params">()</span> &#123;</span><br><span class="line">        doReturn(<span class="string">&quot;foo&quot;</span>).when(spy).get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">&quot;foo&quot;</span>, spy.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="verify-验证"><a href="#verify-验证" class="headerlink" title="verify() 验证"></a>verify() 验证</h3><p>Mockito 会跟踪模拟对象的所有方法调用及其参数。<br>可以使用verify()模拟对象上的方法来验证是否满足指定的条件。例如，可以验证是否已使用某些参数调用了方法。这种测试有时称为行为测试。行为测试不检查方法调用的结果，但它检查是否使用正确的参数调用方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockitoVerifyTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testVerify</span><span class="params">(<span class="meta">@Mock</span> Database database)</span>  &#123;</span><br><span class="line">        <span class="comment">// 打桩</span></span><br><span class="line">        when(database.getUniqueId()).thenReturn(<span class="number">43</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用参数12用模拟对象调用方法</span></span><br><span class="line">        database.setUniqueId(<span class="number">12</span>);</span><br><span class="line">        database.getUniqueId();</span><br><span class="line">        database.getUniqueId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 现在检查是否使用参数12调用了方法</span></span><br><span class="line">        verify(database).setUniqueId(ArgumentMatchers.eq(<span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证这个方法的调用次数，这里是2就代表验证是否调用了两次</span></span><br><span class="line">        verify(database, times(<span class="number">2</span>)).getUniqueId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其他的验证次数方法</span></span><br><span class="line">        verify(database, never()).isAvailable();</span><br><span class="line">        verify(database, never()).setUniqueId(<span class="number">13</span>);</span><br><span class="line">        verify(database, atLeastOnce()).setUniqueId(<span class="number">12</span>);</span><br><span class="line">        verify(database, atLeast(<span class="number">2</span>)).getUniqueId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// times(numberOfTimes)</span></span><br><span class="line">        <span class="comment">// atMost(numberOfTimes)</span></span><br><span class="line">        <span class="comment">// 验证在此对象上没有调用其他方法</span></span><br><span class="line">        <span class="comment">// 在验证了预期的方法调用后调用它</span></span><br><span class="line">        verifyNoMoreInteractions(database);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-InjectMocks-进行依赖注入"><a href="#使用-InjectMocks-进行依赖注入" class="headerlink" title="使用 @InjectMocks 进行依赖注入"></a>使用 @InjectMocks 进行依赖注入</h3><p>被@InjectMocks注解的对象就是要被我们测试的对象，它会被自动的实例化。且其包含的成员变量会被相应的@Mock注解的对象自动赋值。<br>必须使用 Mockito.initMocks(this) 初始化这些模拟对象并注入它们。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleManagerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> ArticleManager manager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    ArticleDatabase database;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    User user; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldDoSomething</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// 测试代码 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Mockito-和-JUnit5"><a href="#Mockito-和-JUnit5" class="headerlink" title="Mockito 和 JUnit5"></a>Mockito 和 JUnit5</h1><h2 id="🍎-使用"><a href="#🍎-使用" class="headerlink" title="🍎  使用"></a>🍎  使用</h2><p>All right ! 上面已经介绍了 Mockito 的基本使用方法，下面来个相对完整的。</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>Spring Boot 2.4.2 + H2 + Lombok + Spring Boot Test (默认包含了Junit5 + Mockito)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-mockito<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-mockito<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mockito<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mockito-junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.21.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>提供以下类，然后使用 Mockito 测试 VolumeUtil。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RINGER_MODE</span> &#123;</span><br><span class="line">RINGER_MODE_NORMAL, RINGER_MODE_SILENT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AudioManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">RINGER_MODE</span> <span class="variable">mode</span> <span class="operator">=</span> RINGER_MODE.RINGER_MODE_SILENT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RINGER_MODE <span class="title function_">getRingerMode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStreamMaxVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStreamVolume</span><span class="params">(<span class="type">int</span> max)</span> &#123;</span><br><span class="line">        volume = max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeReallyLoad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mode.equals(RINGER_MODE.RINGER_MODE_NORMAL)) &#123;</span><br><span class="line">            setStreamVolume(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfThreads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigureThreadingUtil</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">configureThreadPool</span><span class="params">(MyApplication app)</span>&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">numberOfThreads</span> <span class="operator">=</span> app.getNumberOfThreads();</span><br><span class="line">  <span class="comment">// TODO</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolumeUtil</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">maximizeVolume</span><span class="params">(AudioManager audioManager)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (audioManager.getRingerMode() != RINGER_MODE.RINGER_MODE_SILENT) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> audioManager.getStreamMaxVolume();</span><br><span class="line">      audioManager.setStreamVolume(max);</span><br><span class="line">    &#125;</span><br><span class="line">    audioManager.setStreamVolume(<span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="开始测试-VolumeUtil-类"><a href="#开始测试-VolumeUtil-类" class="headerlink" title="开始测试 VolumeUtil 类"></a>开始测试 VolumeUtil 类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mock;</span><br><span class="line"><span class="keyword">import</span> org.mockito.junit.jupiter.MockitoExtension;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.verifyNoMoreInteractions;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VolumeUtilTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    AudioManager audioManager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ensureThatMaximizeVolumeUseConfiguredValueFromAudiomanager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 打桩</span></span><br><span class="line">        when(audioManager.getRingerMode()).thenReturn(RINGER_MODE.RINGER_MODE_NORMAL);</span><br><span class="line">        when(audioManager.getStreamMaxVolume()).thenReturn(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 测试感兴趣的代码即可</span></span><br><span class="line">        VolumeUtil.maximizeVolume(audioManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 验证</span></span><br><span class="line">        verify(audioManager).setStreamVolume(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ensureSilentModeWillNotSetVolumeIsNotDisturbed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. mock 对象</span></span><br><span class="line">        <span class="type">AudioManager</span> <span class="variable">audioManager</span> <span class="operator">=</span> mock(AudioManager.class);</span><br><span class="line">        when(audioManager.getRingerMode()).thenReturn(RINGER_MODE.RINGER_MODE_SILENT);</span><br><span class="line">        <span class="comment">// 2. 测试</span></span><br><span class="line">        VolumeUtil.maximizeVolume(audioManager);</span><br><span class="line">        <span class="comment">// 3. 验证</span></span><br><span class="line">        verify(audioManager).getRingerMode();</span><br><span class="line">        verifyNoMoreInteractions(audioManager);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个报错，发现 VolumeUtil 的错误。<br><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/20240114232903.png"><br>修改 VolumeUtil 类<br><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/20240114232921.png"></p>
<p>为ConfigureThreadingUtil编写一个新的Mockito测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.audio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.only;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.verify;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mock;</span><br><span class="line"><span class="keyword">import</span> org.mockito.junit.jupiter.MockitoExtension;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigureThreadingUtilTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    MyApplication app;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ensureThatThreadPoolCanBeConfigured</span><span class="params">()</span> &#123;</span><br><span class="line">       </span><br><span class="line">        ConfigureThreadingUtil.configureThreadPool(app);</span><br><span class="line">        verify(app, only()).getNumberOfThreads();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="🍎-高级使用"><a href="#🍎-高级使用" class="headerlink" title="🍎 高级使用"></a>🍎 高级使用</h2><h3 id="模拟-final-类和-static-方法"><a href="#模拟-final-类和-static-方法" class="headerlink" title="模拟 final 类和 static 方法"></a>模拟 final 类和 static 方法</h3><p>Mockito 的最新版本还可以模拟 final 类和静态方法。对于 final 类和 final 方法，Mockito 可以正常工作，对于静态方法，必须使用mockStatic方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.mockstatic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.ArgumentMatchers.anyString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.mockito.MockedStatic;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mockito;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStaticDemoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testStaticMockVoid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (MockedStatic&lt;Dummy&gt; dummy = Mockito.mockStatic(Dummy.class)) &#123;</span><br><span class="line">            dummy.when(Dummy::foo).thenReturn(<span class="string">&quot;mocked&quot;</span>);</span><br><span class="line">            dummy.when(() -&gt; Dummy.foo(anyString())).thenReturn(<span class="string">&quot;mockedValue&quot;</span>);</span><br><span class="line"></span><br><span class="line">            assertEquals(<span class="string">&quot;mocked&quot;</span>, Dummy.foo());</span><br><span class="line">            assertEquals(<span class="string">&quot;mockedValue&quot;</span>, Dummy.foo(<span class="string">&quot;para&quot;</span>));</span><br><span class="line">            dummy.verify(() -&gt; Dummy.foo());</span><br><span class="line">            dummy.verify(() -&gt; Dummy.foo(anyString()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Dummy</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">testing</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> var1.length();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="type">String</span> <span class="variable">var1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> String <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;foo&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> String <span class="title function_">foo</span><span class="params">(String var2)</span> &#123;</span><br><span class="line">            var1 = var2;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用反射和-Spy-来更改私有字段"><a href="#使用反射和-Spy-来更改私有字段" class="headerlink" title="使用反射和 Spy 来更改私有字段"></a>使用反射和 Spy 来更改私有字段</h3><p>Mockito 目前无法模拟私有字段或方法。应避免在测试期间更改私有字段或方法，而是在写测试时尝试重构代码。<br>不过从技术上讲，可以结合使用 @Spy 和 Java 反射访问。下面进行演示。<br>类准备</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito.withprivate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassWithPrivateFieldAndMethod</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">field1</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">valueSetByPrivateMethod</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">hiddenField</span> <span class="operator">=</span> <span class="string">&quot;initial&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hiddenField;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValueSetByPrivateMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> valueSetByPrivateMethod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toBeMockedByMockito</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;stuff&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">meineMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        valueSetByPrivateMethod = <span class="string">&quot;lalal&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设现在想要编写一个测试并模拟该 toBeMockedByMockito 方法，使用反射和 Spy 来更改私有字段hiddenField。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.when;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Spy;</span><br><span class="line"><span class="keyword">import</span> org.mockito.junit.jupiter.MockitoExtension;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.vogella.mockito.withprivate.MyClassWithPrivateFieldAndMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClassWithPrivateFieldAndMethodTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Spy</span></span><br><span class="line">    <span class="type">MyClassWithPrivateFieldAndMethod</span> <span class="variable">mock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClassWithPrivateFieldAndMethod</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ensureSpyAndReflectiveAccessCanChangeAPrivateField</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, SecurityException,</span><br><span class="line">            IllegalArgumentException, IllegalAccessException, NoSuchMethodException, InvocationTargetException &#123;</span><br><span class="line">        assertEquals(<span class="string">&quot;initial&quot;</span>, mock.getValue());</span><br><span class="line"></span><br><span class="line">        mock.field1 = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">        when(mock.toBeMockedByMockito()).thenReturn(<span class="string">&quot;mocked by Mockito&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> MyClassWithPrivateFieldAndMethod.class.getDeclaredField(<span class="string">&quot;hiddenField&quot;</span>);</span><br><span class="line">        declaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        declaredField.set(mock, <span class="string">&quot;changed&quot;</span>);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">&quot;Hello&quot;</span>, mock.field1);</span><br><span class="line">        assertEquals(<span class="string">&quot;changed&quot;</span>, mock.getValue());</span><br><span class="line">        assertEquals(<span class="string">&quot;mocked by Mockito&quot;</span>, mock.toBeMockedByMockito());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="使用反射调用私有方法"><a href="#使用反射调用私有方法" class="headerlink" title="使用反射调用私有方法"></a>使用反射调用私有方法</h3><p>使用反射还可以调用私有方法并验证内部值是否已更改，这里演示一下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.mockito;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mockito;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassWithPrivateFieldAndMethodTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrivateMethodInvocation</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建真实对象的 spy（代理）对象</span></span><br><span class="line">        <span class="type">MyClassWithPrivateFieldAndMethod</span> <span class="variable">myObjectSpy</span> <span class="operator">=</span> Mockito.spy(<span class="keyword">new</span> <span class="title class_">MyClassWithPrivateFieldAndMethod</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用反射获取私有方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">privateMethod</span> <span class="operator">=</span> MyClassWithPrivateFieldAndMethod.class.getDeclaredMethod(<span class="string">&quot;meineMethod&quot;</span>);</span><br><span class="line">        privateMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用私有方法</span></span><br><span class="line">        privateMethod.invoke(myObjectSpy);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证内部值是否已更改</span></span><br><span class="line">        assertEquals(<span class="string">&quot;lalal&quot;</span>, myObjectSpy.getValueSetByPrivateMethod());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者，还可以为要模拟的类实现一个包装类，它以不同的方式实现内部或重构代码。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8D%95%E6%B5%8B/">单测</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/2a54e710.html" title="Linux的CPU上下文切换"><img class="cover" src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/Karina9zily.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux的CPU上下文切换</div></div></a></div><div class="next-post pull-right"><a href="/archives/7860726b.html" title="Mockito+Junit5"><img class="cover" src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/rose-165819_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mockito+Junit5</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/7860726b.html" title="Mockito+Junit5"><img class="cover" src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/rose-165819_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-02</div><div class="title">Mockito+Junit5</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODkzOS8zNTQwMQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Daggry</div><div class="author-info__description"><br/>永远相信美好的事情即将发生^_^</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:huangxinpeng21@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">当时年少春衫薄~<br/>你好！2024<br/>小提示：左下角有音乐可以听哦</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E4%B8%80%E4%B8%8B"><span class="toc-number">1.</span> <span class="toc-text">认识一下</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">🚀 什么是单元测试？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">🚀 为什么要进行单元测试？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">🚀 工作流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99"><span class="toc-number">2.</span> <span class="toc-text">如何编写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%AC-%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.1.</span> <span class="toc-text">🐬 编写步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%AC-%E7%BC%96%E5%86%99%E5%8E%9F%E5%88%99"><span class="toc-number">2.2.</span> <span class="toc-text">🐬 编写原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%AC-%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">2.3.</span> <span class="toc-text">🐬 覆盖率</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.2.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.3.</span> <span class="toc-text">计算方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E8%A6%86%E7%9B%96%E5%92%8C%E6%9D%A1%E4%BB%B6%E8%A6%86%E7%9B%96%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.3.4.</span> <span class="toc-text">分支覆盖和条件覆盖的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mock-%E5%92%8C-mockito"><span class="toc-number">3.</span> <span class="toc-text">mock 和 mockito</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%B5-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">🛵 基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A4%94%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%A8%A1%E6%8B%9F%EF%BC%88mock%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">🤔为什么需要模拟（mock）?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%B5-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">🛵 基础使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">3.3.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Mockito-API-%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%8B%9F%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.3.2.</span> <span class="toc-text">使用 Mockito API 创建模拟对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmock%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">3.3.3.</span> <span class="toc-text">配置mock对象方法调用的返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-Spy-%E5%8C%85%E8%A3%85-Java-%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.3.4.</span> <span class="toc-text">用 Spy 包装 Java 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#verify-%E9%AA%8C%E8%AF%81"><span class="toc-number">3.3.5.</span> <span class="toc-text">verify() 验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-InjectMocks-%E8%BF%9B%E8%A1%8C%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">3.3.6.</span> <span class="toc-text">使用 @InjectMocks 进行依赖注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mockito-%E5%92%8C-JUnit5"><span class="toc-number">4.</span> <span class="toc-text">Mockito 和 JUnit5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8D%8E-%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">🍎  使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">4.1.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E6%B5%8B%E8%AF%95-VolumeUtil-%E7%B1%BB"><span class="toc-number">4.1.2.</span> <span class="toc-text">开始测试 VolumeUtil 类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8D%8E-%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8"><span class="toc-number">4.2.</span> <span class="toc-text">🍎 高级使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F-final-%E7%B1%BB%E5%92%8C-static-%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.1.</span> <span class="toc-text">模拟 final 类和 static 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E5%92%8C-Spy-%E6%9D%A5%E6%9B%B4%E6%94%B9%E7%A7%81%E6%9C%89%E5%AD%97%E6%AE%B5"><span class="toc-number">4.2.2.</span> <span class="toc-text">使用反射和 Spy 来更改私有字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.3.</span> <span class="toc-text">使用反射调用私有方法</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/f8089d5.html" title="Http状态码的使用"><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/ghjhgfdc.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Http状态码的使用"/></a><div class="content"><a class="title" href="/archives/f8089d5.html" title="Http状态码的使用">Http状态码的使用</a><time datetime="2023-12-05T12:00:00.000Z" title="发表于 2023-12-05 20:00:00">2023-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/147bd2bf.html" title="全局唯一ID实现方案"><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/pexels-jill-wellington-461189.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全局唯一ID实现方案"/></a><div class="content"><a class="title" href="/archives/147bd2bf.html" title="全局唯一ID实现方案">全局唯一ID实现方案</a><time datetime="2023-11-26T12:00:00.000Z" title="发表于 2023-11-26 20:00:00">2023-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/2a54e710.html" title="Linux的CPU上下文切换"><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/Karina9zily.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux的CPU上下文切换"/></a><div class="content"><a class="title" href="/archives/2a54e710.html" title="Linux的CPU上下文切换">Linux的CPU上下文切换</a><time datetime="2023-11-22T12:00:00.000Z" title="发表于 2023-11-22 20:00:00">2023-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/cef93ee3.html" title="单元测试"><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="单元测试"/></a><div class="content"><a class="title" href="/archives/cef93ee3.html" title="单元测试">单元测试</a><time datetime="2023-11-04T12:00:00.000Z" title="发表于 2023-11-04 20:00:00">2023-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/7860726b.html" title="Mockito+Junit5"><img src="https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/rose-165819_1280.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mockito+Junit5"/></a><div class="content"><a class="title" href="/archives/7860726b.html" title="Mockito+Junit5">Mockito+Junit5</a><time datetime="2023-11-02T12:00:00.000Z" title="发表于 2023-11-02 20:00:00">2023-11-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/sazxsdawn2022/picgoimg/duskimg/blog/adb89b1f0f9f77be99e0e36a903818b097d9ae26.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By Daggry</div><div class="footer_custom_text">很高兴遇见你</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><div class="aplayer no-destroy" data-id="8711920373" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>